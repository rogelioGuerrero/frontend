{"version":3,"sources":["webpack:///./src/pages/clientes/add.vue","webpack:///./src/pages/clientes/add.vue?7d2d","webpack:///./src/composables/addpage.js"],"names":["props","pageName","type","default","routeName","apiPath","submitButtonLabel","formValidationError","formValidationMsg","msgAfterSave","showHeader","showSubmitButton","redirect","isSubPage","pageData","setup","app","useApp","formDefaultValues","name","phone","formData","reactive","rules","computed","v$","useVuelidate","page","useAddPage","beforeSubmit","afterSubmit","response","flashMsg","setFormDefaultValues","navigateTo","toRefs","state","saving","submitted","pageReady","methods","submitForm","getErrorClass","getFieldError","isFieldValid","onMounted","pageTitle","setPageTitle","expose","ref","tag","onSubmit","class","modelValue","modelModifiers","trim","label","placeholder","icon","loading","__exports__","store","useStore","id","errorMsg","apiUrl","validateForm","value","$validate","$invalid","normalizedFormData","Array","isArray","payload","forEach","obj","Object","keys","key","toString","undefined","url","data","dispatch","closeDialogs","showPageRequestError","storeFormData","getters","assign","field","index","isInvalid","$each","$response","$errors","length","fieldErrors","$silentErrors","$message","watch","current","deep","immediate","computedProps"],"mappings":"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","file":"js/chunk-277f6954.d2b77e2f.js","sourcesContent":["<template>\r\n    <div class=\"main-page\">\r\n        <template v-if=\"showHeader\">\r\n            <section class=\"page-section mb-3\" >\r\n                <div class=\"container\">\r\n                    <div class=\"grid justify-content-between\">\r\n                        <div class=\"col \" >\r\n                            <div class=\"\">\r\n                                <div class=\" text-2xl text-primary font-bold\" >\r\n                                    Agregar nuevo\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </section>\r\n        </template>\r\n        <section class=\"page-section \" >\r\n            <div class=\"container\">\r\n                <div class=\"grid \">\r\n                    <div class=\"md:col-9 sm:col-12 comp-grid\" >\r\n                        <div class=\"\">\r\n                            <div class=\"\">\r\n                                <div >\r\n                                    <form ref=\"observer\" tag=\"form\" @submit.prevent=\"submitForm()\" class=\"\" :class=\"{ 'card': !isSubPage }\">\r\n                                        <div class=\"grid\">\r\n                                            <div class=\"col-12\">\r\n                                                <div class=\"formgrid grid\">\r\n                                                    <div class=\"col-12 md:col-3\">\r\n                                                        Name \r\n                                                    </div>\r\n                                                    <div class=\"col-12 md:col-9\">\r\n                                                        <InputText ref=\"ctrlname\" v-model.trim=\"formData.name\"  label=\"Name\" type=\"text\" placeholder=\"Escribir Name\"      \r\n                                                        class=\" w-full\" :class=\"getErrorClass('name')\">\r\n                                                        </InputText>\r\n                                                        <small v-if=\"isFieldValid('name')\" class=\"p-error\">{{ getFieldError('name') }}</small> \r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div class=\"col-12\">\r\n                                                <div class=\"formgrid grid\">\r\n                                                    <div class=\"col-12 md:col-3\">\r\n                                                        Phone \r\n                                                    </div>\r\n                                                    <div class=\"col-12 md:col-9\">\r\n                                                        <InputText ref=\"ctrlphone\" v-model.trim=\"formData.phone\"  label=\"Phone\" type=\"text\" placeholder=\"Escribir Phone\"      \r\n                                                        class=\" w-full\" :class=\"getErrorClass('phone')\">\r\n                                                        </InputText>\r\n                                                        <small v-if=\"isFieldValid('phone')\" class=\"p-error\">{{ getFieldError('phone') }}</small> \r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div v-if=\"showSubmitButton\" class=\"text-center my-3\">\r\n                                            <Button class=\"p-button-primary\" type=\"submit\" label=\"Entregar\" icon=\"pi pi-send\" :loading=\"saving\" />\r\n                                        </div>\r\n                                    </form>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    </div>\r\n</template>\r\n<script setup>\r\n\timport {  computed,  reactive, toRefs, onMounted } from 'vue';\r\n\timport useVuelidate from '@vuelidate/core';\r\n\timport { required } from '@/services/validators';\r\n\timport { useApp } from '@/composables/app.js';\r\n\timport { useAddPage } from '@/composables/addpage.js';\r\n\tconst props = defineProps({\r\n\t\tpageName : {\r\n\t\t\ttype : String,\r\n\t\t\tdefault : 'clientes',\r\n\t\t},\r\n\t\trouteName : {\r\n\t\t\ttype : String,\r\n\t\t\tdefault : 'clientesadd',\r\n\t\t},\r\n\t\tapiPath : {\r\n\t\t\ttype : String,\r\n\t\t\tdefault : 'clientes/add',\r\n\t\t},\r\n\t\tsubmitButtonLabel: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"Entregar\",\r\n\t\t},\r\n\t\tformValidationError: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"El formulario no es vÃ¡lido\",\r\n\t\t},\r\n\t\tformValidationMsg: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"Por favor complete el formulario\",\r\n\t\t},\r\n\t\tmsgAfterSave: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"Grabar agregado exitosamente\",\r\n\t\t},\r\n\t\tshowHeader: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tshowSubmitButton: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tredirect: {\r\n\t\t\ttype : Boolean,\r\n\t\t\tdefault : true,\r\n\t\t},\r\n\t\tisSubPage: {\r\n\t\t\ttype : Boolean,\r\n\t\t\tdefault : false,\r\n\t\t},\r\n\t\tpageData: { // use to set formData default values from another page\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => {} \r\n\t\t},\r\n\t});\r\n\tconst app = useApp();\r\n\tconst formDefaultValues = {\r\n\t\tname: \"\", \r\n\t\tphone: \"\", \r\n\t};\r\n\tconst formData = reactive({ ...formDefaultValues });\r\n\t//form validation rules\r\n\tconst rules = computed(() => {\r\n\t\treturn {\r\n\t\t\tname: {  },\r\n\t\t\tphone: {  }\r\n\t\t}\r\n\t});\r\n\tconst v$ = useVuelidate(rules, formData); // form validation\r\n\tconst page = useAddPage({ props, formData, v$, beforeSubmit, afterSubmit });\r\n\t// perform custom validation before submit form\r\n\t// set custom form fields\r\n\t// return false if validation fails\r\n\tfunction beforeSubmit(){\r\n\t\treturn true;\r\n\t}\r\n\t// after form submited to api\r\n\t// reset form data.\r\n\t// redirect to another page\r\n\tfunction afterSubmit(response) {\r\n\t\tapp.flashMsg(props.msgAfterSave);\r\n\t\tpage.setFormDefaultValues(); //reset form data\r\n\t\tif(props.redirect) app.navigateTo(`/clientes`);\r\n\t}\r\n\t//page state\r\n\tconst {\r\n\t\tsubmitted, // form submitted state - Boolean\r\n\t\tsaving, // form api submiting state - Boolean\r\n\t\tpageReady, // if api data loaded successfully\r\n\t} = toRefs(page.state);\r\n\t//page methods\r\n\tconst {\r\n\t\tsubmitForm, //submit form data to api\r\n\t\tgetErrorClass, // return error class if field is invalid- args(fieldname)\r\n\t\tgetFieldError, //  get validation error message - args(fieldname)\r\n\t\tisFieldValid, // check if field is validated - args(fieldname)\r\n\t\t // map api datasource  to Select options label-value\r\n\t} = page.methods;\r\n\tonMounted(()=>{\r\n\t\tconst pageTitle = \"Agregar nuevo\";\r\n\t\tapp.setPageTitle(props.routeName, pageTitle); // set browser page title\r\n\t});\r\n\t// expose page object for other components access\r\n\tdefineExpose({\r\n\t\tpage\r\n\t});\r\n</script>\r\n<style scoped>\r\n</style>\r\n","import script from \"./add.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./add.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { reactive, computed, onMounted, watch } from \"vue\";\r\n\r\nimport { useApp } from '@/composables/app';\r\nimport { useStore } from 'vuex';\r\n\r\n\r\nexport function useAddPage({props, formData, v$, beforeSubmit, afterSubmit}) {\r\n\tconst app = useApp();\r\n\tconst store = useStore();\r\n\tconst state = reactive({\r\n\t\tid: null,\r\n\t\tpageReady: false,\r\n\t\tsubmitted: false,\r\n\t\tsaving: false,\r\n\t\terrorMsg: ''\r\n\t});\r\n\r\n\tsetFormDefaultValues();\r\n\r\n\tconst apiUrl = computed(() => {\r\n\t\treturn props.apiPath\r\n\t});\r\n\r\n\tfunction validateForm(){\r\n\t\tstate.submitted = true;\r\n\t\tv$.value.$validate();\r\n\t\tif(v$.value.$invalid){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction normalizedFormData(){\r\n\t\tif(Array.isArray(formData)){ // for multi form data\r\n\t\t\tconst payload = [...formData];\r\n\t\t\tpayload.forEach(function(obj){\r\n\t\t\t\tObject.keys(obj).forEach(function(key){\r\n\t\t\t\t\tif(Array.isArray(obj[key])){\r\n\t\t\t\t\t\tobj[key] = obj[key].toString()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn payload;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tconst payload = {...formData};\r\n\t\t\tObject.keys(payload).forEach(function(key){\r\n\t\t\t\tif(Array.isArray(payload[key])){\r\n\t\t\t\t\tpayload[key] = payload[key].toString()\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn payload;\r\n\t\t}\r\n\t}\r\n\r\n\tasync function submitForm(){\r\n\t\tstate.submitted = true;\r\n\t\tif(beforeSubmit !== undefined){\r\n\t\t\tif(!beforeSubmit()){ return; }\r\n\t\t}\r\n\r\n\t\tif(!validateForm()){\r\n\t\t\tapp.flashMsg(props.formValidationError, props.formValidationMsg, \"error\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\r\n\t\tstate.saving = true;\r\n\t\tconst url = apiUrl.value;\r\n\t\tconst payload = normalizedFormData();\r\n\t\tlet data = { url, payload }\r\n\t\ttry{\r\n\t\t\tconst response = await store.dispatch(`${props.pageName}/saveRecord`, data);\r\n\t\t\tapp.closeDialogs();// hide dialog if form is submitted via modal\r\n\t\t\tif(afterSubmit){\r\n\t\t\t\tafterSubmit(response)\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(err) {\r\n\t\t\tapp.showPageRequestError(err);\r\n\t\t}\r\n\t\tfinally{\r\n\t\t\tstate.submitted = false;\r\n\t\t\tstate.saving = false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setFormDefaultValues(){\r\n\t\tconst storeFormData = computed (()=> store.getters[`${props.pageName}/formData`]); // from data from store\r\n\t\tconst pageData = props.pageData; // when form default values is passed by component props\r\n\t\tconst formDefaultValues = { ...pageData, ...storeFormData.value };\r\n\t\t\r\n\t\tif(!Array.isArray(formData)){\r\n\t\t\tObject.assign(formData, formDefaultValues); //reset form data\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction getErrorClass(field, index){\r\n\t\tlet isInvalid = false;\r\n\t\tif(index === undefined){\r\n\t\t\tisInvalid = v$.value[field].$invalid && state.submitted;\r\n\t\t}\r\n\t\t//for multi form validation\r\n\t\telse if(v$.value.$each.$response.$errors[index][field].length && state.submitted){\r\n\t\t\tisInvalid = true;\r\n\t\t}\r\n\t\treturn {\"p-invalid\": isInvalid };\r\n\t}\r\n\r\n\tfunction isFieldValid(field, index){\r\n\t\tif(index===undefined){\r\n\t\t\treturn v$.value[field].$invalid && state.submitted;\t\r\n\t\t}\r\n\t\telse if(v$.value.$each.$response.$errors[index][field].length && state.submitted){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\r\n\tfunction getFieldError(field, index){\r\n\t\tlet fieldErrors = null;\r\n\t\tif(index===undefined){\r\n\t\t\tfieldErrors = v$.value[field].$silentErrors;\r\n\t\t\tif(fieldErrors.length){\r\n\t\t\t\treturn fieldErrors[0].$message; //return the first error\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\tfieldErrors = v$.value.$each.$response.$errors[index][field];\r\n\t\t\tif(fieldErrors.length){\r\n\t\t\t\treturn fieldErrors[0].$message; //return the first error\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\t\r\n\t\r\n\twatch(() => props.pageData, (current) => {\r\n\t\tObject.assign(formData, current);\r\n\t  },\r\n\t  { deep: true, immediate: true }\r\n  \t);\r\n\r\n\tonMounted(()=>{ \r\n\t\tstate.pageReady = true;\r\n\t});\r\n\r\n\tconst computedProps = {\r\n\t\tapiUrl,\r\n\t}\r\n\r\n\tconst methods = {\r\n\t\tsubmitForm,\r\n\t\tgetErrorClass,\r\n\t\tgetFieldError,\r\n\t\tisFieldValid\r\n\t}\r\n\t\r\n\treturn {\r\n\t\tvalidateForm,\r\n\t\tsetFormDefaultValues,\r\n\t\tformData,\r\n\t\tstate,\r\n\t\tcomputedProps,\r\n\t\tmethods\r\n\t}\r\n\r\n}"],"sourceRoot":""}